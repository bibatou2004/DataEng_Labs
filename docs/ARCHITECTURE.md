# ğŸ—ï¸ Architecture Star Schema

## Dimensions

### dim_customer
```
customer_sk (PK) â”‚ customer_id â”‚ name â”‚ email â”‚ created_at
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[hash]           â”‚ 1           â”‚ Aliceâ”‚ ...   â”‚ 2024-01-01
```

### dim_product
```
product_sk â”‚ product_id â”‚ product_name â”‚ brand_sk â”‚ category_sk â”‚ price
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€
[hash]     â”‚ 1          â”‚ iPhone 15    â”‚ [hash]   â”‚ [hash]      â”‚ 999.99
```

### dim_date
```
date_sk â”‚ date       â”‚ year â”‚ month â”‚ day â”‚ dow â”‚ quarter â”‚ week_of_year
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[hash]  â”‚ 2024-06-01 â”‚ 2024 â”‚ 6     â”‚ 1   â”‚ Sat â”‚ 2       â”‚ 23
```

## Table de Faits

### fact_sales
```
order_id â”‚ date_sk â”‚ customer_sk â”‚ product_sk â”‚ quantity â”‚ unit_price â”‚ subtotal â”‚ year â”‚ month
â”€â”€â”€â”€â”€â”€â”€â”€ â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€
1        â”‚ [hash]  â”‚ [hash]      â”‚ [hash]     â”‚ 2        â”‚ 999.99     â”‚ 1999.98  â”‚ 2024 â”‚ 6
```

## Fluxes de DonnÃ©es

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SOURCES (Bronze Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ customers.csv â†’ dim_customer            â”‚
â”‚ brands.csv â†’ dim_brand                  â”‚
â”‚ categories.csv â†’ dim_category           â”‚
â”‚ products.csv â†’ dim_product (+ FKs)      â”‚
â”‚ orders.csv â†’ fact_sales                 â”‚
â”‚ order_items.csv â†’ fact_sales (mesures) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TRANSFORMATIONS (Silver/Gold Layers)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Load & validate schemas              â”‚
â”‚ 2. Generate surrogate keys (xxhash64)   â”‚
â”‚ 3. Create dimensions                    â”‚
â”‚ 4. Build fact table with joins          â”‚
â”‚ 5. Validate quality (PK, FK, nulls)     â”‚
â”‚ 6. Partition & compress (Parquet)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OUTPUTS (Gold Layer - Parquet)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dim_customer.parquet                    â”‚
â”‚ dim_brand.parquet                       â”‚
â”‚ dim_category.parquet                    â”‚
â”‚ dim_product.parquet                     â”‚
â”‚ dim_date.parquet                        â”‚
â”‚ fact_sales.parquet (year/month)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Joins

```python
# Fact table construction
fact_sales = (
    order_items             # Base: 100 rows
    .join(products,         # 100 Ã— 20 lookups
          on="product_id")
    .join(orders,           # Preserve order context
          on="order_id")
    .join(customers,        # Add customer dimension
          on="customer_id")
    .join(dim_date,         # Add date dimension
          on="date_sk")
)
```

## Partitionnement

```
fact_sales/
â”œâ”€â”€ year=2024/
â”‚   â”œâ”€â”€ month=6/
â”‚   â”‚   â”œâ”€â”€ part-00000.parquet
â”‚   â”‚   â”œâ”€â”€ part-00001.parquet
â”‚   â”‚   â””â”€â”€ _SUCCESS
â”‚   â”œâ”€â”€ month=7/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ month=8/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ month=11/
â”‚       â””â”€â”€ ...
```

**BÃ©nÃ©fices:**
- âœ… RequÃªtes par date ultra-rapides
- âœ… Nettoyage incrÃ©mental (drop partitions)
- âœ… ParrallÃ©lisation par partition

---

**Voir aussi:** DATA_SCHEMA.md pour les dÃ©tails
